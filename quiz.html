<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Mario Quiz</title>
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
  <style>
    body { 
      font-family: 'Press Start 2P', cursive; 
      background: #000 url('https://i.postimg.cc/https://postimg.cc/jLnwfhYQ/background.png') repeat;
      background-size: 256px 256px; 
      image-rendering: pixelated; 
      color: #fff; text-shadow: 2px 2px #000; 
      margin: 0; padding: 20px; height: 100vh; overflow: hidden; 
    }
    .quiz { text-align: center; max-width: 500px; margin: auto; }
    button { font-family: inherit; font-size: 14px; padding: 15px 25px; margin: 10px; border: 4px solid #fff; 
             background: #444; color: #fff; cursor: pointer; image-rendering: pixelated; }
    button:hover { background: #666; }
    button.correct { background: #0f0 !important; }
    button.wrong { background: #f00 !important; }
    input { border: 3px solid #fff; background: #222; color: #fff; padding: 10px; font-family: inherit; }
  </style>
</head>
<body>
  <div class="quiz" id="namePrompt" style="display:none;">
    <h2>Enter your name:</h2>
    <input id="nameInput" type="text" placeholder="Player1" maxlength="20">
    <br><button onclick="saveName()">OK</button>
  </div>

  <div class="quiz" id="quizContent" style="display:none;">
    <h1 id="question"></h1>
    <button id="opt1"></button><br>
    <button id="opt2"></button><br>
    <button id="opt3"></button><br>
    <button onclick="continueGame()">Continue! Go</button>
  </div>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-app.js';
    import { getDatabase, ref, transaction } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-database.js';
    import { getAuth, signInAnonymously, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.14.1/firebase-auth.js';

    // ←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←
  
    const firebaseConfig = {
      apiKey: "AIzaSyDrL9ekV4tmzNx2N_KjXC_zneI26dgBryU",
      authDomain: "x-culture--pitch-arena.firebaseapp.com",
      databaseURL: "https://x-culture--pitch-arena-default-rtdb.firebaseio.com",
      projectId: "x-culture--pitch-arena",
      storageBucket: "x-culture--pitch-arena.firebasestorage.app",
      messagingSenderId: "642180627612",
      appId: "1:642180627612:web:af97fc0187215160d70159"
    };
    // ←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←←

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);
    const auth = getAuth(app);

    const urlParams = new URLSearchParams(window.location.search);
    const qNum = parseInt(urlParams.get('q')) || 1;

    const questions = {
      1: { q: '2 + 2 = ?', opts: [{text:'4', correct:true}, {text:'5', correct:false}, {text:'3', correct:false}] },
      2: { q: 'Capital of Vietnam?', opts: [{text:'Hanoi', correct:true}, {text:'Ho Chi Minh', correct:false}, {text:'Da Nang', correct:false}] },
      3: { q: 'What happens when Mario eats a mushroom?', opts: [{text:'Grows bigger', correct:true}, {text:'Can fly', correct:false}, {text:'Dies', correct:false}] },
      4: { q: 'What shape is the Earth?', opts: [{text:'Round', correct:true}, {text:'Square', correct:false}, {text:'Flat', correct:false}] },
      5: { q: '1 + 1 = ?', opts: [{text:'2', correct:true}, {text:'11', correct:false}, {text:'0', correct:false}] }
    };

    const q = questions[qNum];
    if (!q) { document.body.innerHTML = '<h1>Invalid Quiz ID: '+qNum+'</h1>'; }

    let userUid, userName;
    const storedName = localStorage.getItem('marioPlayerName');

    signInAnonymously(auth).catch(console.error);
    onAuthStateChanged(auth, (user) => {
      if (user) {
        userUid = user.uid;
        if (storedName) {
          userName = storedName;
          showQuiz();
        } else {
          document.getElementById('namePrompt').style.display = 'block';
        }
      }
    });

    window.saveName = function() {
      userName = document.getElementById('nameInput').value.trim() || 'Anonymous';
      localStorage.setItem('marioPlayerName', userName);
      showQuiz();
    };

    function showQuiz() {
      document.getElementById('namePrompt').style.display = 'none';
      document.getElementById('quizContent').style.display = 'block';
      document.getElementById('question').textContent = q.q;
      const opts = document.querySelectorAll('button[id^="opt"]');
      opts.forEach((btn, i) => {
        btn.textContent = q.opts[i].text;
        btn.onclick = () => answer(q.opts[i].correct, btn);
      });
    }

    function answer(isCorrect, btn) {
      btn.classList.add(isCorrect ? 'correct' : 'wrong');
      if (isCorrect) {
        const scoreRef = ref(db, 'scores/' + userUid);
        transaction(scoreRef, (current) => {
          if (current) current.score += 1;
          else current = { name: userName, score: 1 };
          return current;
        });
        alert('CORRECT! +1 point');
      } else {
        alert('WRONG! You can still continue');
      }
    }

    window.continueGame = function() {
      window.close();
    }
  </script>
</body>
</html>